# ------------------------------
# 1. Change prefix key (from Ctrl-b to Alt-a)
# ------------------------------
unbind C-b
set-option -g prefix M-a
bind-key M-a send-prefix

# ------------------------------
# 2. Nice colored status bar (without session name)
# --- Clean status bar, no left/right content ---
set -g status on
set -g status-bg colour234
set -g status-fg white
set -g status-left ""
set -g status-right ""
set -g status-interval 5
set -g status-justify left
set -g window-status-separator " "

# --- Inactive tabs (windows) ---
set -g window-status-style bg=colour238,fg=white
set -g window-status-format " #I:#W "

# --- Active tab (current window) ---
set -g window-status-current-style bg=colour34,fg=black,bold
set -g window-status-current-format " #I:#W "

# --- Activity on a background tab stands out ---
set -g window-status-activity-style underscore

# Pane borders: normal vs active
set -g pane-border-style fg=colour238
set -g pane-active-border-style fg=colour34

# When you hit Prefix + q to show pane numbers
set -g display-panes-colour colour240
set -g display-panes-active-colour colour34


# ------------------------------
# 3. Mouse support
# ------------------------------
set -g mouse on

# ------------------------------
# Extra quality-of-life improvements
# ------------------------------

# Allow true color (for modern terminals like WezTerm/Kitty/Alacritty)
set -g default-terminal "tmux-256color"
set -as terminal-overrides ',xterm-256color:Tc'

# Vim-like pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Split panes using | s  and -
bind | split-window -h
unbind s
bind - split-window -v
bind s split-window -h
unbind '"'
unbind %

##### Mouse & copy-mode selection that scrolls + robust clipboard #####
set -g mouse on
setw -g mode-keys vi

# Make sure the tmux server inherits GUI env (needed for wl-copy/xclip)
set -g update-environment "DISPLAY WAYLAND_DISPLAY XDG_SESSION_TYPE XDG_RUNTIME_DIR DBUS_SESSION_BUS_ADDRESS SSH_ASKPASS SSH_AUTH_SOCK"

# Enter copy-mode with wheel; keep passing wheel events when already in copy-mode
bind -T root WheelUpPane   if -F "#{pane_in_mode}" "send-keys -M" "copy-mode -e"
bind -T root WheelDownPane if -F "#{pane_in_mode}" "send-keys -M" "send-keys -M"

# Start selection on drag
bind -T copy-mode-vi MouseDrag1Pane send -X begin-selection

# On release: copy selection to system clipboard (Wayland -> wl-copy, else X11 -> xclip)
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-pipe-and-cancel "sh -lc '
  if command -v wl-copy >/dev/null 2>&1 && [ -n \"\$WAYLAND_DISPLAY\" ]; then
    wl-copy
  elif command -v xclip >/dev/null 2>&1; then
    xclip -selection clipboard -in
  else
    cat >/dev/null
  fi
'"

# Wheel in copy-mode moves by half pages (good for long selections)
bind -T copy-mode-vi WheelUpPane   send -X halfpage-up
bind -T copy-mode-vi WheelDownPane send -X halfpage-down

# (Optional) Also copy with keyboard: press Enter in copy-mode to copy to clipboard
bind -T copy-mode-vi Enter send -X copy-pipe-and-cancel "sh -lc '
  if command -v wl-copy >/dev/null 2>&1 && [ -n \"\$WAYLAND_DISPLAY\" ]; then
    wl-copy
  elif command -v xclip >/dev/null 2>&1; then
    xclip -selection clipboard -in
  else
    cat >/dev/null
  fi
'"


# Reload config without restarting tmux
bind r source-file ~/.tmux.conf \; display "Reloaded ~/.tmux.conf"
